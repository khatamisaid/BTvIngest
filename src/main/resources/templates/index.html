<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/styles.css}" />
    <link rel="shortcut icon" sizes="16x16" th:href="@{/images/BTV.ico}" />
    <!-- Bootstrap 5 CSS -->
    <link
      rel="stylesheet"
      th:href="@{/css/bootstrap.min.css}"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <!-- Font Awesome 5 -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css"
    />
    <link rel="stylesheet" th:href="@{/css/jquery.dataTables.min.css}" />
    <!-- <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    /> -->
    <style>
      .bd-example-modal-lg .modal-dialog {
        display: table;
        position: relative;
        margin: 0 auto;
        top: calc(50% - 24px);
      }

      .bd-example-modal-lg .modal-dialog .modal-content {
        background-color: transparent;
        border: none;
      }
    </style>
    <title>Ingest</title>
  </head>

  <body>
    <header class="masthead">
      <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
          <a class="navbar-brand" href="#!"
            ><img
              class="img-fluid me-2"
              th:src="@{/images/BTV.svg}"
              alt=""
              style="width: 80px"
          /></a>
          <button
            class="navbar-toggler"
            type="button"
            data-bs-toggle="collapse"
            data-bs-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
              <li class="nav-item">
                <a class="nav-link"
                  ><button
                    class="action submit btn btn-sm btn-outline-success float-end"
                    data-toggle="modal"
                    data-target="#modalform"
                  >
                    Materi
                  </button></a
                >
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </header>

    <div class="container">
      <div class="card">
        <div class="card-header">DATA</div>
        <div class="card-body">
          <div class="table-responsive">
            <table
              id="dt-responsive"
              class="table table-striped dt-responsive nowrap w-100 dataTable dtr-inline"
              role="grid"
              aria-describedby="myTable2_info"
            >
              <!-- thead -->
              <thead>
                <tr role="row">
                  <th>#</th>
                  <th>judul</th>
                  <th>reporter</th>
                  <th>deskripsi</th>
                  <th>action</th>
                </tr>
              </thead>
              <!-- /thead -->
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Footer-->
    <footer class="py-5 bg-dark">
      <div class="container">
        <p class="m-0 text-center text-white">Copyright &copy; Team IT 2022</p>
      </div>
    </footer>

    <div class="modal fade" id="modalview" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog container d-flex justify-content-center">
        <div class="modal-content" style="min-width: 720px !important">
          <div class="modal-body">
            <div class="narik">
              <div class="container d-flex justify-content-center">
                <div class="col-11 col-offset-2">
                  <div class="card-header">Detail Ingest</div>

                  <div class="container justify-content-center">
                    <!-- MUNCULIN DETAILS INGEST -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalform" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog container d-flex justify-content-center">
        <div class="modal-content" style="min-width: 720px !important">
          <div class="modal-body">
            <div class="narik">
              <div class="container d-flex justify-content-center">
                <div class="col-11 col-offset-2">
                  <div class="card-header">ISI DATA</div>
                  <form
                    id="formMateri"
                    action="#"
                    enctype="multipart/form-data"
                  >
                    <div class="card-body">
                      <div class="mb-3">
                        <label>judul</label>
                        <input
                          type="text"
                          name="judul"
                          id="judul"
                          class="form-control"
                          required="true"
                        />
                        <p class="text-danger" id="err_judul"></p>
                      </div>
                      <div class="mb-3">
                        <label>no tape</label>
                        <input
                          type="text"
                          name="no_tape"
                          id="no_tape"
                          class="form-control"
                          required="true"
                        />
                      </div>
                      <div class="mb-3">
                        <label for="reporter" class="form-label"
                          >reporter</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="reporter"
                          name="reporter"
                          placeholder="Nama Reporter"
                          value=""
                        />
                      </div>
                      <div class="mb-3">
                        <label for="tim_liputan" class="form-label"
                          >Tim Liputan</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="tim_liputan"
                          name="tim_liputan"
                          placeholder="Team Liputan"
                        />
                      </div>
                      <div class="mb-3">
                        <label for="lok_liputan" class="form-label"
                          >Lokasi Liputan</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="lok_liputan"
                          name="lok_liputan"
                          placeholder="Lokasi Liputan"
                        />
                      </div>
                      <div class="mb-3">
                        <label for="deskripsi" class="form-label"
                          >deksripsi</label
                        >
                        <input
                          type="text"
                          class="form-control"
                          id="deskripsi"
                          name="deskripsi"
                          placeholder="deskripsi Liputan"
                        />
                      </div>
                      <div class="mb-3">
                        <label for="file" class="form-label"
                          >Upload Files</label
                        >
                        <input
                          type="file"
                          class="form-control"
                          name="file"
                          id="file"
                          accept="video/mp4,video/x-m4v,video/*"
                        />
                      </div>
                      <div class="col-12">
                        <input
                          type="button"
                          id="nambah"
                          value="Tambah Data"
                          class="btn btn-primary"
                          name="falidasi"
                        />
                      </div>
                    </div>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="modalDetail" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg d-flex justify-content-center">
        <div class="modal-content" style="min-width: 720px !important">
          <div class="modal-header">
            <h5 class="modal-title">Detail Materi</h5>
            <button
              type="button btn-close"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <div class="d-flex justify-content-center">
              <video id="videoDetail" width="400" height="400" controls>
                <source src="" type="video/mp4" />
                Your browser does not support HTML video.
              </video>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade bd-example-modal-lg"
      data-backdrop="static"
      data-keyboard="false"
      tabindex="-1"
      id="modalLoading"
    >
      <div class="modal-dialog modal-sm">
        <div class="modal-content" style="width: 48px">
          <span class="fa fa-spinner fa-spin fa-3x"></span>
        </div>
      </div>
    </div>
    <script type="text/javascript" th:src="@{/js/jquery-3.3.1.min.js}"></script>
    <!-- <script type="text/javascript" th:src="@{/js/tools.js}"></script> -->
    <script
      th:src="@{/js/popper.min.js}"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      th:src="@{/js/bootstrap.min.js}"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <script type="text/javascript" th:src="@{/js/sweetalert2.js}"></script>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.1.3/axios.min.js"
      integrity="sha512-0qU9M9jfqPw6FKkPafM3gy2CBAvUWnYVOfNPDYKVuRTel1PrciTj+a9P3loJB+j0QmN2Y0JYQmkBBS8W+mbezg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
    <script
      type="text/javascript"
      th:src="@{/js/jquery.dataTables.min.js}"
    ></script>
    <script th:inline="javascript">
      /*<![CDATA[*/
      $(document).ready(function () {
        showTable();
      });
      $("#nambah").on("click", function () {
        $("#modalform").modal("toggle");
        $("#modalLoading").modal("toggle");
        var url = `/postMateri?judul=${$("#judul").val()}&no_tape=${$(
          "#no_tape"
        ).val()}&reporter=${$("#reporter").val()}&tim_liputan=${$(
          "#tim_liputan"
        ).val()}&lok_liputan=${$("#lok_liputan").val()}&deskripsi=${$(
          "#deskripsi"
        ).val()}`;
        var bodyFormData = new FormData();
        var photo = $("#file").prop("files");
        bodyFormData.append("file", photo[0]);
        axios({
          method: "post",
          url: url,
          data: bodyFormData,
          headers: { "Content-Type": "multipart/form-data" },
        })
          .then(function (response) {
            $("#modalLoading").modal("toggle");
            Swal.fire({
              position: "center",
              icon: response.data.icon,
              title: response.data.message,
              showConfirmButton: false,
              timer: 1500,
            }).then((result) => {
              $("#modalLoading").modal("toggle");
              table.ajax.reload();
            });
          })
          .catch(function (response) {
            $("#modalLoading").modal("toggle");
            Swal.fire({
              position: "center",
              icon: response.data.icon,
              title: response.data.message,
              showConfirmButton: false,
              timer: 1500,
            }).then((result) => {
              $("#modalLoading").modal("toggle");
              table.ajax.reload();
            });
          });
      });
      /*]]>*/
      var table;
      function showTable() {
        table = $("#dt-responsive").DataTable({
          dom: "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>\n        <'table-responsive'tr>\n        <'row align-items-center'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7 d-flex justify-content-end'p>>",
          language: {
            zeroRecords: "Data Tidak Ada",
            paginate: {
              previous: '<i class="fa fa-lg fa-angle-left"></i>',
              next: '<i class="fa fa-lg fa-angle-right"></i>',
            },
          },
          searching: false,
          stateSave: false,
          serverSide: true,
          processing: true,
          lengthMenu: [5, 15, 50],
          ajax: function (data, callback, settings) {
            var page = Math.ceil(
              settings._iDisplayStart / settings._iDisplayLength
            );
            var url = `/findAll?start=${page}&length=${data.length}`;
            $.get(url, function (response) {
              var out = [];
              response.data.content.forEach(function (materi, i) {
                var action = `<div class="d-flex justify-content-around"><a id="buttonViewDocList"
                                                                  name="buttonViewPageList"
                                                                  title="Detail" data-toggle="modal" data-target="#modalDetail"
                                                                  onclick="getById(${materi.id})" 
                                                                  class="btn btn-sm btn-icon btn-secondary text-white"><i class="fa fa-eye"></i></a><a id="btnConfirmDelete"
                                                                   onclick="deleteById(${materi.id})" 
                                                                   class="btn btn-sm btn-icon btn-secondary" 
                                                                   id="btnConfirmDelete"
                                                                   title="Hapus"><i class="fa fa-trash text-white"></i></a><div>`;
                out.push([
                  "",
                  materi.judul,
                  materi.reporter,
                  materi.deskripsi,
                  action,
                ]);
              });
              callback({
                recordsTotal: response.data.totalElements,
                recordsFiltered: response.data.totalElements,
                data: out,
              });
            });
          },
          deferRender: true,
        });
      }

      function getById(id) {
        $.get(`/find?id=${id}`, function (res) {
          var materi = res.data;
          var extension = materi.files.split(".");
          extension = extension[extension.length - 1];
          var video = materi.files.replace(`.${extension}`, "");
          $("#videoDetail source").attr("src", `/video/stream/${extension}/${video}`);
          $("#videoDetail")[0].load();
        });
      }
      function deleteById(id) {
        Swal.fire({
          title: "Yakin ingin menghapus Materi?",
          showCancelButton: true,
          cancelButtonText: "Tidak",
          confirmButtonText: "Ya",
          confirmButtonColor: "#dc3545",
        }).then((result) => {
          /* Read more about isConfirmed, isDenied below */
          if (result.isConfirmed) {
            $.ajax({
              url: `/materi?id=${id}`,
              method: "DELETE",
              success: function (data, textStatus, jqXHR) {
                Swal.fire({
                  position: "center",
                  icon: "success",
                  title: data.message,
                  showConfirmButton: false,
                  timer: 1500,
                }).then((result) => {
                  table.ajax.reload();
                });
              },
            });
          }
        });
      }
    </script>
  </body>
  <!-- Core theme JS-->
</html>
